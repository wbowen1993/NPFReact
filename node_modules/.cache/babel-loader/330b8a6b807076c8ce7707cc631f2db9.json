{"ast":null,"code":"import _defineProperty from \"/Users/bowenwang/Nodejs_project/NPFReact/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"/Users/bowenwang/Nodejs_project/NPFReact/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/bowenwang/Nodejs_project/NPFReact/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/Users/bowenwang/Nodejs_project/NPFReact/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/bowenwang/Nodejs_project/NPFReact/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _inherits from \"/Users/bowenwang/Nodejs_project/NPFReact/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _assertThisInitialized from \"/Users/bowenwang/Nodejs_project/NPFReact/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nvar _jsxFileName = \"/Users/bowenwang/Nodejs_project/NPFReact/src/component/User/User.js\";\nimport React, { Component } from 'react';\nimport { Redirect } from 'react-router-dom';\nimport \"./login.css\";\nimport Notification from \"../Control/Notification\";\nimport Login from \"./Login\";\nimport Signup from \"./Signup\";\n\nvar User =\n/*#__PURE__*/\nfunction (_Component) {\n  _inherits(User, _Component);\n\n  function User(props) {\n    var _this;\n\n    _classCallCheck(this, User);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(User).call(this, props));\n\n    _this.renderRedirect = function () {\n      if (_this.state.redirect) return React.createElement(Redirect, {\n        to: {\n          pathname: _this.state.redirect_path,\n          msg: _this.state.notif_msg,\n          state: _this.state.state\n        },\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 133\n        },\n        __self: this\n      });\n    };\n\n    _this.state = {\n      email: '',\n      password: '',\n      reenter: '',\n      email_err: '',\n      password_err: '',\n      reenter_err: '',\n      server_err: '',\n      login_disp: true,\n      redirect: false,\n      notif_msg: '',\n      redirect_path: '/notification'\n    };\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.showValidation = _this.showValidation.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.clearValidation = _this.clearValidation.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.handleSignUpSubmit = _this.handleSignUpSubmit.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.handleLoginSubmit = _this.handleLoginSubmit.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.boxShow = _this.boxShow.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.validate = _this.validate.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.verify = _this.verify.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.renderRedirect = _this.renderRedirect.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    _this.error_msg_reset = _this.error_msg_reset.bind(_assertThisInitialized(_assertThisInitialized(_this)));\n    return _this;\n  }\n\n  _createClass(User, [{\n    key: \"handleChange\",\n    value: function handleChange(event) {\n      this.setState(_defineProperty({}, event.target.name, event.target.value));\n      if (this.state.login_disp == false || this.state.login_disp && event.target.name != \"password\") this.validate([event.target.name], event.target.value);\n    } //state code as property to pass to the notification page: 0 for server error, 1 for mail server error/info\n\n  }, {\n    key: \"handleSignUpSubmit\",\n    value: function handleSignUpSubmit(event) {\n      var _this2 = this;\n\n      var SERVER_ERR_MSG = \"Oops, it seems that we have some troubles for our server\";\n\n      if (this.verify()) {\n        fetch(\"/user/signup\", {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            \"email\": this.state.email,\n            \"password\": this.state.password\n          })\n        }).then(function (res) {\n          return res.json();\n        }).then(function (res) {\n          if (res.state === 1) _this2.showValidation(\"server_err\", res.msg);else if (res.state === 0 || res.state === 2) {\n            //2 for sucess and 0 for server error(database)\n            _this2.setState({\n              redirect: true,\n              notif_msg: res.msg,\n              state: 1,\n              redirect_path: '/notification'\n            });\n          } else if (res.state === 3) {\n            //3 for session issue\n            _this2.setState({\n              redirect: true,\n              notif_msg: res.msg,\n              state: 2,\n              redirect_path: '/notification'\n            });\n          }\n        }).catch(function (err) {\n          console.log(err);\n\n          _this2.setState({\n            redirect: true,\n            notif_msg: SERVER_ERR_MSG,\n            state: 0,\n            redirect_path: '/notification'\n          });\n        });\n      }\n\n      event.preventDefault();\n    }\n  }, {\n    key: \"handleLoginSubmit\",\n    value: function handleLoginSubmit(event) {\n      var _this3 = this;\n\n      var SERVER_ERR_MSG = \"Oops, it seems that we have some troubles for our server\";\n\n      if (this.verify()) {\n        fetch(\"/user/login\", {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            \"email\": this.state.email,\n            \"password\": this.state.password\n          })\n        }).then(function (res) {\n          return res.json();\n        }).then(function (res) {\n          if (res.state === 1) _this3.showValidation(\"server_err\", res.msg);else if (res.state === 0) {\n            _this3.setState({\n              redirect: true,\n              notif_msg: res.msg,\n              state: 0,\n              redirect_path: '/notification'\n            });\n          } else if (res.state === 2) {\n            //TODO redirect profile page\n            // this.boxShow();\n            _this3.setState({\n              redirect: true,\n              redirect_path: '/'\n            });\n          } else if (res.state === 3) {\n            _this3.setState({\n              redirect: true,\n              notif_msg: res.msg,\n              state: 2,\n              redirect_path: '/notification'\n            });\n          }\n        }).catch(function (err) {\n          console.log(err);\n\n          _this3.setState({\n            redirect: true,\n            notif_msg: SERVER_ERR_MSG,\n            state: 0,\n            redirect_path: '/notification'\n          });\n        });\n      }\n\n      event.preventDefault();\n    }\n  }, {\n    key: \"boxShow\",\n    value: function boxShow() {\n      this.setState({\n        login_disp: !this.state.login_disp\n      });\n      this.error_msg_reset();\n    }\n  }, {\n    key: \"showValidation\",\n    value: function showValidation(elm, msg) {\n      this.setState(_defineProperty({}, elm, msg));\n    }\n  }, {\n    key: \"clearValidation\",\n    value: function clearValidation(elm) {\n      this.setState(_defineProperty({}, elm, ''));\n    }\n  }, {\n    key: \"error_msg_reset\",\n    value: function error_msg_reset() {\n      this.setState({\n        email_err: '',\n        password_err: '',\n        reenter_err: '',\n        server_err: ''\n      });\n    }\n  }, {\n    key: \"validate\",\n    value: function validate(type, value) {\n      var re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n\n      if (type == 'email') {\n        if (!re.test(String(value).toLowerCase())) {\n          this.showValidation(\"email_err\", \"Please type valid email\");\n        } else {\n          this.clearValidation(\"email_err\");\n        }\n      }\n\n      if (type == 'password') {\n        var validPassword = false;\n        if (value.length >= 8 && /\\d/.test(value) && /[a-z]/.test(value) && /[A-Z]/.test(value)) validPassword = true; // console.log(value);\n\n        if (this.state.password != '' && !validPassword) {\n          this.showValidation(\"password_err\", \"Password must contain\\n1. 8 characters at least;\\n2. digit, uppercase and lowercase\");\n        } else {\n          console.log(\"passed\");\n          this.clearValidation(\"password_err\");\n        }\n      }\n\n      if (type == 'reenter') {\n        if (!this.state.login_disp && value != '' && value != this.state.password) {\n          this.showValidation(\"reenter_err\", \"Different with your password\");\n        } else {\n          this.clearValidation(\"reenter_err\");\n        }\n      }\n    }\n  }, {\n    key: \"verify\",\n    value: function verify() {\n      if (this.state.email_err == '' && this.state.password_err.length == '' && this.state.reenter_err == '') return true;\n      return false;\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var handlers = {\n        showHandler: this.boxShow,\n        changeHandler: this.handleChange,\n        loginSubmitHandler: this.handleLoginSubmit,\n        signupSubmitHandler: this.handleSignUpSubmit,\n        verifyHandler: this.verify\n      };\n      var errorMsg = {\n        email_err: this.state.email_err,\n        password_err: this.state.password_err,\n        reenter_err: this.state.reenter_err\n      };\n      return React.createElement(\"div\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 196\n        },\n        __self: this\n      }, this.renderRedirect(), React.createElement(\"div\", {\n        className: \"bng\",\n        id: \"user_bng\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 198\n        },\n        __self: this\n      }, this.state.login_disp && React.createElement(Login, {\n        handlers: handlers,\n        error: errorMsg,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199\n        },\n        __self: this\n      }), !this.state.login_disp && React.createElement(Signup, {\n        handlers: handlers,\n        error: errorMsg,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200\n        },\n        __self: this\n      })));\n    }\n  }]);\n\n  return User;\n}(Component);\n\nexport { User as default };","map":{"version":3,"sources":["/Users/bowenwang/Nodejs_project/NPFReact/src/component/User/User.js"],"names":["React","Component","Redirect","Notification","Login","Signup","User","props","renderRedirect","state","redirect","pathname","redirect_path","msg","notif_msg","email","password","reenter","email_err","password_err","reenter_err","server_err","login_disp","handleChange","bind","showValidation","clearValidation","handleSignUpSubmit","handleLoginSubmit","boxShow","validate","verify","error_msg_reset","event","setState","target","name","value","SERVER_ERR_MSG","fetch","method","headers","body","JSON","stringify","then","res","json","catch","err","console","log","preventDefault","elm","type","re","test","String","toLowerCase","validPassword","length","handlers","showHandler","changeHandler","loginSubmitHandler","signupSubmitHandler","verifyHandler","errorMsg"],"mappings":"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","sourcesContent":["import React, {Component} from 'react';\nimport { Redirect } from 'react-router-dom';\nimport \"./login.css\";\nimport Notification from \"../Control/Notification\";\nimport Login from \"./Login\";\nimport Signup from \"./Signup\";\n\nexport default class User extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      email: '',\n      password: '', \n      reenter: '',\n      email_err:'', \n      password_err: '', \n      reenter_err: '',\n      server_err: '',\n      login_disp: true,\n      redirect: false,\n      notif_msg:'',\n      redirect_path: '/notification'\n    };\n\n    this.handleChange = this.handleChange.bind(this);\n    this.showValidation = this.showValidation.bind(this);\n    this.clearValidation = this.clearValidation.bind(this);\n    this.handleSignUpSubmit = this.handleSignUpSubmit.bind(this);\n    this.handleLoginSubmit = this.handleLoginSubmit.bind(this);\n    this.boxShow = this.boxShow.bind(this);\n    this.validate = this.validate.bind(this);\n    this.verify = this.verify.bind(this);\n    this.renderRedirect = this.renderRedirect.bind(this);\n    this.error_msg_reset = this.error_msg_reset.bind(this);\n  }\n\n  handleChange(event) {\n    this.setState({[event.target.name]: event.target.value});\n    if(this.state.login_disp == false || (this.state.login_disp && event.target.name != \"password\"))\n      this.validate([event.target.name], event.target.value);\n  }\n\n  //state code as property to pass to the notification page: 0 for server error, 1 for mail server error/info\n  handleSignUpSubmit(event) {\n    const SERVER_ERR_MSG = \"Oops, it seems that we have some troubles for our server\";\n    if(this.verify()){\n      fetch(\"/user/signup\", {\n        method:'POST',\n        headers:{'Content-Type': 'application/json'},  \n        body:JSON.stringify({\n          \"email\":this.state.email,\n          \"password\":this.state.password  \n        })\n      }).then((res) => {\n        return res.json();\n      }).then((res) => {\n        if(res.state === 1)\n          this.showValidation(\"server_err\", res.msg);\n        else if(res.state === 0 || res.state === 2){\n          //2 for sucess and 0 for server error(database)\n          this.setState({redirect:true, notif_msg: res.msg, state:1, redirect_path: '/notification'});\n        }\n        else if(res.state === 3){\n          //3 for session issue\n          this.setState({redirect:true, notif_msg: res.msg, state:2, redirect_path: '/notification'});\n        }\n\n      })\n      .catch((err) => {\n        console.log(err);\n        this.setState({redirect:true, notif_msg: SERVER_ERR_MSG, state:0, redirect_path: '/notification'});\n      });\n    }\n\n    event.preventDefault();\n  }\n\n  handleLoginSubmit(event) {\n    const SERVER_ERR_MSG = \"Oops, it seems that we have some troubles for our server\";\n    if(this.verify()){\n      fetch(\"/user/login\", {\n        method:'POST',\n        headers:{'Content-Type': 'application/json'},  \n        body:JSON.stringify({\n          \"email\":this.state.email,\n          \"password\":this.state.password  \n        })\n      }).then((res) => {\n        return res.json();\n      }).then((res) => {\n        if(res.state === 1)\n          this.showValidation(\"server_err\", res.msg);\n        else if(res.state === 0){\n          this.setState({redirect:true, notif_msg: res.msg, state: 0, redirect_path: '/notification'});\n        }\n        else if(res.state === 2){\n          //TODO redirect profile page\n          // this.boxShow();\n          this.setState({redirect:true, redirect_path: '/'});\n        }\n        else if(res.state === 3){\n          this.setState({redirect:true, notif_msg: res.msg, state: 2, redirect_path: '/notification'});\n        }\n\n      })\n      .catch((err) => {\n        console.log(err);\n        this.setState({redirect:true, notif_msg: SERVER_ERR_MSG, state: 0, redirect_path: '/notification'});\n      });\n    }\n    event.preventDefault();\n  }\n\n  boxShow(){\n    this.setState({login_disp: !this.state.login_disp});\n    this.error_msg_reset();\n  }\n\n  showValidation(elm, msg){\n    this.setState({[elm]: msg});\n  }\n\n  clearValidation(elm){\n    this.setState({[elm]: ''});\n  }\n\n  error_msg_reset(){\n    this.setState({email_err:'', password_err:'', reenter_err:'', server_err:''})\n  }\n\n  renderRedirect = () => {\n    if(this.state.redirect)\n      return <Redirect to={{pathname:this.state.redirect_path, msg: this.state.notif_msg, state: this.state.state}} />\n  }\n\n\n  validate(type, value){\n    let re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    if(type == 'email'){\n      if(!re.test(String(value).toLowerCase())){\n        this.showValidation(\"email_err\", \"Please type valid email\");\n      }\n      else{\n        this.clearValidation(\"email_err\");\n      }\n    }\n\n    if(type == 'password'){\n      let validPassword = false;\n      if(value.length >= 8 && /\\d/.test(value) && /[a-z]/.test(value) && /[A-Z]/.test(value))\n        validPassword = true;\n      // console.log(value);\n      if(this.state.password != '' && !validPassword){\n        this.showValidation(\"password_err\", \"Password must contain\\n1. 8 characters at least;\\n2. digit, uppercase and lowercase\");\n      }\n      else{\n        console.log(\"passed\");\n        this.clearValidation(\"password_err\");\n      }\n    }\n\n    if(type == 'reenter'){\n      if(!this.state.login_disp && value != '' && value != this.state.password){\n        this.showValidation(\"reenter_err\", \"Different with your password\");\n      }\n      else{\n        this.clearValidation(\"reenter_err\");\n      }\n    }\n  }\n\n  verify(){\n    if(this.state.email_err == '' && this.state.password_err.length == '' && this.state.reenter_err == '')\n      return true;\n    return false;\n  }\n\n  render() {\n\n    var handlers = {\n      showHandler: this.boxShow,\n      changeHandler: this.handleChange,\n      loginSubmitHandler: this.handleLoginSubmit,\n      signupSubmitHandler: this.handleSignUpSubmit,\n      verifyHandler: this.verify\n    }\n\n    var errorMsg = {\n      email_err: this.state.email_err,\n      password_err: this.state.password_err,\n      reenter_err:this.state.reenter_err\n    }\n\n    return (\n      \n      <div>\n        {this.renderRedirect()}\n        <div className=\"bng\" id=\"user_bng\">\n          {this.state.login_disp && <Login handlers={handlers} error={errorMsg}/>}\n          {!this.state.login_disp && <Signup handlers={handlers} error={errorMsg}/>}\n        </div>\n      </div>\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}